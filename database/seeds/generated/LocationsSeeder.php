<?php

use Illuminate\Database\Seeder;
use ViKon\Utilities\SeederProgressBarTrait;
use App\Location;
use App\Repositories\Backend\Location\LocationContract;
use Carbon\Carbon;
use Maatwebsite\Excel\Facades\Excel;

/**
 * Generated by vi-kon/db-exporter
 *
 * @author KovÃ¡cs Vince<vincekovacs@hotmail.com>
 */
class LocationsSeeder extends Seeder {
    use SeederProgressBarTrait;

    protected $output;

    protected $structure = array (
  0 => 'id',
  1 => 'parent_id',
  2 => 'lft',
  3 => 'rgt',
  4 => 'depth',
  5 => 'name',
  6 => 'type',
  7 => 'pcode',
  8 => 'alt_name',
  9 => 'mya_name',
  10 => 'alt_mya_name',
  11 => 'long',
  12 => 'lat',
  13 => 'created_at',
  14 => 'updated_at',
);

	/**
	 * Run the database seeds.
	 *
	 * @return void
	 */
	public function run()
	{
	    DB::table('locations')->delete();
            

        $this->output = $this->command->getOutput();

        $progress = $this->createProgressBar();
        $this->command->line('<info>Inserting data:</info> locations');
        $progress->start(82037);

        $data = include(__DIR__ . '/data/locations_table_data.php');
	    foreach($data as $row) {
	        $this->create($row);
	        $progress->advance();
	    }

        $progress->finish();
        $this->command->getOutput()->writeln('');
	}

	protected function create($values) {
	    $data = [];
        foreach ($this->structure as $i => $key) {
            $data[$key] = $values[$i];
        }
        if($data['parent_id'] == 0){
            $data['parent_id'] = null;
        }
        array_splice($data, 2, 3);
	   Location::create($data);
        //Location::buildTree($data);
	}

}
